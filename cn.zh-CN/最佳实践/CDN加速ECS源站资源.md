# CDN加速ECS源站资源

阿里云CDN加速ECS主要实现ECS上静态资源加速。ECS上可存储的资源包括静态资源和动态资源。当您访问ECS上的资源时，动态资源请求直接返回给您，静态资源通过CDN实现访问加速，由CDN节点返回给您。通过本文您可以详细了解，CDN加速ECS的应用场景，以及通过CDN控制台实现CDN加速ECS的操作方法。

执行本文操作之前，请确保您已完成阿里云[账号注册](https://account.aliyun.com/register/register.htm)和[实名认证](https://account.console.aliyun.com/#/auth/home)。

阿里云CDN配合精准的调度系统，将您对静态资源的请求分配至最近节点，使您以最快的速度读取到所需的资源，有效解决网络拥塞问题，提高您访问资源的响应速度。

ECS上存储的动态资源包括web程序和数据库，静态资源包括静态脚本、图片、附件和音频/视频。当ECS作为源站，您请求访问或下载资源时，ECS上的动态资源直接返回给您；ECS上的静态资源可以通过CDN加速实现请求加速，将源站上的资源缓存到CDN的加速节点，系统自动调用离您最近的CDN节点上已缓存的资源。加速ECS架构如下图所示。

![应用场景](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0211008951/p51266.png)

**说明：** ECS上的动态资源可以通过全站加速实现请求加速，相关操作请参见[全站加速](https://help.aliyun.com/product/64812.html)。

ECS作为CDN的源站，通过CDN加速分发，并通过CDN节点就近获得资源，架构优势如下：

-   用户访问网站资源，全部通过CDN，降低源站压力。
-   使用CDN流量，单价低于ECS直接访问外网流量。
-   资源从距离客户端最近的CDN节点获取，减少网络传输距离，保证静态资源质量。

本文以阿里云云解析DNS为例，介绍配置CNAME的操作方法。

1.  在CDN控制台上，添加ECS域名。

    1.  登录[CDN控制台](https://cdn.console.aliyun.com)。

    2.  在左侧导航栏，单击**域名管理**。

    3.  在**域名管理**页面，单击**添加域名**。

    4.  根据如下表格填写域名信息，并选择源站类型为**IP**或**源站域名**。

        |参数|参数分类|说明|
        |--|----|--|
        |**加速域名**|-|输入用户域名，例如：ch.aliyun.com。注意事项如下：

        -   加速域名一般使用子域名或泛域名，例如： `cdntest.example.com`。
        -   支持泛域名加速，不支持中文域名加速，请注意泛域名填写规则如： `*.test.com`。详细规则请参见[泛域名加速规则]()。
        -   加速域名不允许重复添加，如出现**域名已添加**的提示，请[提交工单处理](https://selfservice.console.aliyun.com/ticket/createIndex)。
        -   如果泛域名未被添加到任何CDN账号下，则其支持多个CDN账号添加不同的子域名。
        -   每个账户下最多支持50个加速域名，如需扩容请[提交工单处理](https://selfservice.console.aliyun.com/ticket/createIndex)。
        -   加速内容必须合法且符合CDN业务规范，详情请参见 [CDN服务使用限制](/cn.zh-CN/产品简介/使用限制.md)。 |
        |**资源分组**|-|选择加速域名所属的资源组。 **说明：** 新开通CDN服务的用户，不显示**资源分组**。如果您需要使用资源组功能，则需要登录[资源管理控制台](https://resourcemanager.console.aliyun.com)，根据界面提示开通资源组服务，并创建资源组，操作方法请参见[创建资源组](https://help.aliyun.com/document_detail/94485.html)。 |
        |**业务类型**|[图片小文件](/cn.zh-CN/产品简介/应用场景/图片小文件.md)|若您网站的加速内容多为小型的静态资源 （如小文件、图片、网页样式文件等），推荐您选择**图片小文件**业务类型。|
        |[大文件下载](/cn.zh-CN/产品简介/应用场景/大文件下载.md)|若您的加速内容为较大的文件（大于20MB的静态文件），例如游戏安装包、应用更新、手机ROM升级、应用程序包下载等场景，推荐选择**大文件下载**业务类型。|
        |[视频点播加速](/cn.zh-CN/产品简介/应用场景/视音频点播.md)|若您需要加速音频或视频文件，例如音乐、视频的点播业务场景，推荐使用**视音频点播**业务类型。|
        |[全站加速](/cn.zh-CN/产品简介/应用场景/全站加速.md)|如果您的网站或应用含有大量动静态内容混合、且较多为动态资源请求，您可以使用全站加速。通过简单配置即可使系统分别加速动静态内容，静态内容高速缓存，动态内容通过阿里云的最优链路算法及协议层优化快速回源获取。

当您选择**全站加速**业务类型时，根据界面提示前往全站加速控制台，添加域名并进行相关配置，操作方法请参见[添加加速域名]()。 |
        |[安全加速](/cn.zh-CN/产品简介/应用场景/安全加速.md)|如果您的网站易遭受攻击且必须兼顾加速的业务场景，则需要使用安全加速功能，提升全站安全性。 当您选择**安全加速**业务类型时，根据界面提示前往安全加速控制台，添加域名并进行相关配置，操作方法请参见[添加加速域名](https://help.aliyun.com/document_detail/63607.html)。 |
        |**源站信息**|**IP**或**源站域名**|        -   **IP**：填写您的服务器外网IP，支持多个服务器外网IP。
        -   **源站域名**：填写您的源站域名，支持多个源站域名。

**说明：** 源站域名不能与加速域名相同，否则会造成循环解析，无法回源。例如您的源站域名为`img.yourdomain.com`，则加速域名可设置为`cdn.yourdomain.com`。 |
        |**端口**|-|根据您的需求选择访问端口。

        -   80端口

以HTTP协议访问资源。

        -   443端口

以HTTPS协议访问资源。 |
        |**加速区域**|**仅中国内地**|如果选择**仅中国内地**，则需要工信部备案。域名备案方法，请参见[加速域名备案](/cn.zh-CN/产品简介/使用限制.md)。|
        |**全球**|如果选择**全球**，则需要工信部备案。域名备案方法，请参见[加速域名备案](/cn.zh-CN/产品简介/使用限制.md)。|
        |**全球（不包含中国内地）**|如果选择**全球（不包含中国内地）**，则无需工信部备案。|

        ![添加域名](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0211008951/p94764.png)

    5.  单击**下一步**。

        当您的加速域名审核通过后，会出现在**域名管理**的域名列表中。状态为**正常运行**，表示添加成功。

        ![添加域名成功](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0211008951/p62084.png)

2.  在CDN控制台上，获取CNAME。

    1.  登录[CDN控制台](https://cdn.console.aliyun.com)。

    2.  在左侧导航栏，单击**域名管理**。

    3.  进入**域名管理**页面，复制加速域名对应的CNAME值。

        ![域名管理](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/0211008951/p66555.png)

3.  在阿里云云解析DNS控制台上，配置CNAME。

    1.  登录[阿里云云解析DNS控制台](https://dc.console.aliyun.com/dns)。

    2.  进入**域名解析**页面，在您需要设置的域名后面，单击**解析设置**。

    3.  单击**添加记录**，添加CNAME记录。

        **说明：**

        -   您添加CNAME记录时如果遇到冲突问题，建议更换一个加速域名或调整冲突的记录。详细信息，请参见[域名解析冲突](/cn.zh-CN/快速入门/配置CNAME/配置CNAME域名解析.md)。
        -   一个加速域名对应一个CNAME地址，主域名的CNAME地址不能被二级域名使用。如果您需要加速二级域名，需将二级域名也添加到CDN上，并解析到对应的CNAME地址，或者在CDN上添加泛域名，泛域名的CNAME可以被二级域名使用。
        -   精准域名解析的CNAME大于泛域名解析的CNAME，即当您的加速域名为泛域名，且主机记录设置为星号（\*）时，需删除泛域名下所有已生效的二级域名的解析记录。
        ![添加记录](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/5843918061/p64412.png)

        -   记录类型：选择`CNAME`。
        -   主机记录：加速域名的前缀。

            |如果您的加速域名为|主机记录为|
            |:--------|:----|
            |`testcdn.aliyun.com`|`testcdn`|
            |`www.aliyun.com`|`www`|
            |`aliyun.com`|`@`|
            |`*.aliyun.com`|`*`|

        -   解析线路：默认值。
        -   记录值：输入加速域名对应的CNAME地址。
        -   TTL：默认值。
    4.  单击**确认**。

        成功配置CNAME且生效后，加速服务会立即生效。

        **说明：**

        -   新增CNAME记录实时生效，修改CNAME记录在72小时内生效。
        -   成功配置CNAME后状态更新约有10分钟延迟，控制台的域名列表页可能仍提示“未配置CNAME”，请您暂时忽略。
4.  在本地PC机上，验证CNAME配置是否生效。

    1.  打开Windows的CMD命令行程序。

    2.  在命令行中ping加速域名，如果返回的解析结果和CDN控制台上该加速域名的CNAME值一致，则表示CDN加速已经生效。

        ![CNAME生效验证](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/6423839951/p66693.png)


