# 水印管理

CDN支持图片水印和文字水印。您可以通过水印参数为图片文件添加图片水印和水印文字。本文为您介绍为图片添加水印时所用到的功能及参数。

**说明：**

-   目前图片处理功能处于内测阶段，您需[提交工单](https://workorder-intl.console.aliyun.com/?spm=5176.2020520001.aliyun_topbar.18.dbd44bd3e4f845#/ticket/createIndex)申请开通。
-   图片处理为付费服务，内测期间**暂不收费**，收费时间另行通知。

## 图片水印

操作名称：`watermark`。

下表列出了图片水印支持的功能及功能对应的参数。

**说明：**

-   图片水印暂不支持缩放，水印图片原图不能超过1 MB。
-   支持同时添加多个水印，且支持同时添加图片水印和文字水印，最多支持添加5个。

|支持的功能|功能描述|参数|取值范围|
|-----|----|--|----|
|水印地址|指定可以访问的图片水印地址，水印地址可以公开访问，若有鉴权或权限设置，可能导致获取水印地址失败。水印地址需进行Base64编码。详细信息，请参见[水印编码](#section_xlb_u1r_uk2)。

|image|Base64编码后的字符串。|

示例如下：

-   图片水印：`image_process=watermark,image_Base64编码后的图片请求,x_20,y_20,g_se,t_70`。
-   文字加图片水印：`image_process=watermark,text_Base64编码后的文字内容,x_10,y_10,g_nw,size_24,color_FF0000,t_70/watermark,image_Base64编码后的图片请求,x_20,y_20,g_se,t_70`。

## 文字水印

操作名称：`watermark`。

下表列出了文字水印支持的功能及功能对应的参数。

**说明：** 支持同时添加多个水印，且支持同时添加图片水印和文字水印，最多支持添加5个。

|支持的功能|功能描述|参数|取值范围|
|-----|----|--|----|
|文字内容|指定文字水印的文字内容，文字内容需进行Base64编码。详细信息，请参见[水印编码](#section_xlb_u1r_uk2)。|text|Base64编码后的字符串，最大长度不能超过60个字符。|
|文字字体|指定文字水印的字体，字体名称需进行Base64编码。详细信息，请参见[水印编码](#section_xlb_u1r_uk2)。|type|共支持10种文字字体，字体及字体编码请参见[表 1](#table_34s_n6t_ufa)。**说明：** 如果您使用的是10种文字字体之外的其他字体，系统会识别出您使用的是默认字体alihyaihei。 |
|文字颜色|指定文字水印的文字颜色，参数值为RGB颜色值。|color|RGB颜色值，例如：000000表示黑色，FFFFFF表示白色。 默认值：000000（黑色）。 |
|文字旋转|指定文字顺时针旋转角度。|rotate|支持按顺时针旋转90°、180°和270°。|
|文字铺满|指定是否将文字水印铺满原图。|fill|取值范围\[0,1\]，默认值为0。-   0：表示不将文字水印铺满全图。
-   1：表示将文字水印铺满原图。 |

示例如下：

-   文字水印：`image_process=watermark,text_Base64编码后的文字内容,type_YWxpaHlhaWhlaQ,x_10,y_10,g_se,size_24,color_FF0000,t_70,rotate_45,fill_0`。
-   文字加图片水印：`image_process=watermark,text_Base64编码后的文字内容,x_10,y_10,g_nw,size_24,color_FF0000,t_70/watermark,image_Base64编码后的图片请求,x_20,y_20,g_se,t_70`。

下表列出了文字水印支持的10种文字字体。

|文字字体|中文含义|编码值|
|----|----|---|
|alihyaihei|阿里汉仪智能黑体，默认字体|YWxpaHlhaWhlaQ|
|hysong|汉仪宋体|aHlzb25n|
|hyhei|汉仪黑体|aHloZWk|
|hyshuangxian|汉仪双线体|aHlzaHVhbmd4aWFu|
|fzltzhk|方正兰亭中黑|ZnpsdHpoaw|
|fzshengsks|方正盛世楷书|ZnpzaGVuZ3Nrcw|
|fzqusongjian|方正趣宋简体|ZnpxdXNvbmdqaWFu|
|zzgfxingyan|造字工房星岩|enpnZnhpbmd5YW4|
|comfortaa|Comfortaa|Y29tZm9ydGFh|
|notosans|NotoSans|bm90b3NhbnM|

## 水印位置

图片水印和文字水印均可以按照九宫格定位、水印垂直边距和水印水平边距来设置水印的位置。九宫格定位、垂直边距和水平边距不仅可以调节水印在图片中的位置，当图片存在多重水印时，还可以调节水印在图中的布局。区域数值以及每个区域对应的基准点如下图所示。

![水印位置](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/7375876061/p186559.png)

|参数|描述|取值范围|
|--|--|----|
|t|指定水印图片或水印文字的透明度。|\[0,100\] 默认值为100， 表示透明度100%（不透明）。 |
|g|指定水印在图片中的位置。|-   nw：左上
-   north：中上
-   ne：右上
-   west：左中
-   center：中部
-   east：右中
-   sw：左下
-   south：中下
-   se：右下

详情请参见上方基准点图片。|
|x|指定水印的水平边距， 即距离图片边缘的水平距离。这个参数只有当水印位置是左上、左中、左下、右上、右中、右下才有意义。|\[0,4096\] 默认值为10 ，单位：px（像素）。 |
|y|指定水印的垂直边距，即距离图片边缘的垂直距离。 这个参数只有当水印位置是左上、中上、右上、左下、中下、右下才有意义。|\[0,4096\] 默认值为10， 单位：px（像素）。 |

## 水印编码

在添加水印操作中，文字水印的文字内容、文字字体和图片水印的水印地址需要进行URL安全的Base64编码。编码方式如下：

1.  将内容编码成Base64。
2.  替换编码结果中的部分编码。
    -   将结果中的加号（+）替换成短划线（-）。
    -   将结果中的正斜线（/）替换成下划线（\_）。
    -   将结果中尾部的等号（=）省略。

推荐通过[URL-safe Baes64编码工具](https://simplycalc.com/base64url-encode.php)对文字水印的文字内容、文字字体和图片水印的水印地址进行编码。

**说明：** 水印编码后的内容仅应用在水印操作的特定参数中，请勿将其用在签名字符串（Signature）的内容里。

